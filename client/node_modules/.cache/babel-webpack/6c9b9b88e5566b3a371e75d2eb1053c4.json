{"ast":null,"code":"import _asyncToGenerator from \"D:/Code/angular-crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { costumers } from '../data/data';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class CostumersService {\n  constructor(httpClient) {\n    this.httpClient = httpClient;\n    this.pageUsers = new Map();\n    this._costumers = costumers;\n  }\n\n  get getCostumersLength() {\n    return this._costumers.length;\n  }\n\n  getCostumersByPage(itemsPerPage, page) {\n    const endIndex = itemsPerPage * (page + 1);\n    const startingIndex = endIndex - itemsPerPage;\n\n    if (endIndex < this._costumers.length) {\n      return this.getCostumersByPage(itemsPerPage, page);\n    } else {\n      return this.loadRandomUsers(itemsPerPage);\n    }\n  }\n\n  getCostumersFromStorage(amount, page) {\n    let costumersList = [];\n    const endIndex = amount * (page + 1);\n    const startingIndex = endIndex - amount;\n\n    for (let i = startingIndex; i < this._costumers.length && i < endIndex; i++) {\n      costumersList.push(this._costumers[i]);\n    }\n\n    return costumersList;\n  }\n\n  loadRandomUsers(itemsPerPage) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const pageNumber = 1;\n      const users = yield _this.httpClient.get(`https://randomuser.me/api/?page=${pageNumber}&results=${itemsPerPage}`).toPromise();\n      console.log({\n        users\n      });\n\n      _this._costumers.push(...users.results);\n\n      _this.saveToLocalstorage();\n\n      return users.results;\n    })();\n  }\n\n  saveToLocalstorage() {\n    localStorage.setItem('costumers', JSON.stringify(this._costumers));\n  }\n\n  loadLocalstorage() {\n    const costumers = localStorage.getItem('costumers');\n    if (costumers) this._costumers = JSON.parse(costumers);\n  }\n\n}\n\nCostumersService.ɵfac = function CostumersService_Factory(t) {\n  return new (t || CostumersService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nCostumersService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CostumersService,\n  factory: CostumersService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["D:\\Code\\angular-crm\\src\\app\\services\\costumers.service.ts"],"names":[],"mappings":";AAEA,SAAS,SAAT,QAA0B,cAA1B;;;AAMA,OAAM,MAAO,gBAAP,CAAuB;AAQ3B,EAAA,WAAA,CAA6B,UAA7B,EAAmD;AAAtB,SAAA,UAAA,GAAA,UAAA;AALpB,SAAA,SAAA,GAAuC,IAAI,GAAJ,EAAvC;AAMP,SAAK,UAAL,GAAkB,SAAlB;AACD;;AAEqB,MAAlB,kBAAkB,GAAA;AACpB,WAAO,KAAK,UAAL,CAAgB,MAAvB;AACD;;AAED,EAAA,kBAAkB,CAAC,YAAD,EAAuB,IAAvB,EAAmC;AACnD,UAAM,QAAQ,GAAG,YAAY,IAAI,IAAI,GAAG,CAAX,CAA7B;AACA,UAAM,aAAa,GAAG,QAAQ,GAAG,YAAjC;;AACA,QAAI,QAAQ,GAAG,KAAK,UAAL,CAAgB,MAA/B,EAAuC;AACrC,aAAO,KAAK,kBAAL,CAAwB,YAAxB,EAAsC,IAAtC,CAAP;AACD,KAFD,MAEO;AACL,aAAO,KAAK,eAAL,CAAqB,YAArB,CAAP;AACD;AACF;;AAED,EAAA,uBAAuB,CAAC,MAAD,EAAiB,IAAjB,EAA6B;AAClD,QAAI,aAAa,GAAU,EAA3B;AACA,UAAM,QAAQ,GAAG,MAAM,IAAI,IAAI,GAAG,CAAX,CAAvB;AACA,UAAM,aAAa,GAAG,QAAQ,GAAG,MAAjC;;AACA,SACE,IAAI,CAAC,GAAG,aADV,EAEE,CAAC,GAAG,KAAK,UAAL,CAAgB,MAApB,IAA8B,CAAC,GAAG,QAFpC,EAGE,CAAC,EAHH,EAIE;AACA,MAAA,aAAa,CAAC,IAAd,CAAmB,KAAK,UAAL,CAAgB,CAAhB,CAAnB;AACD;;AACD,WAAO,aAAP;AACD;;AAEK,EAAA,eAAe,CACnB,YADmB,EACC;AAAA;;AAAA;AAEpB,YAAM,UAAU,GAAG,CAAnB;AACA,YAAM,KAAK,SAAS,KAAI,CAAC,UAAL,CACjB,GADiB,CAEhB,mCAAmC,UAAU,YAAY,YAAY,EAFrD,EAIjB,SAJiB,EAApB;AAKA,MAAA,OAAO,CAAC,GAAR,CAAY;AAAE,QAAA;AAAF,OAAZ;;AAEA,MAAA,KAAI,CAAC,UAAL,CAAgB,IAAhB,CAAqB,GAAI,KAAK,CAAC,OAA/B;;AACA,MAAA,KAAI,CAAC,kBAAL;;AACA,aAAO,KAAK,CAAC,OAAb;AAZoB;AAarB;;AAEO,EAAA,kBAAkB,GAAA;AACxB,IAAA,YAAY,CAAC,OAAb,CAAqB,WAArB,EAAkC,IAAI,CAAC,SAAL,CAAe,KAAK,UAApB,CAAlC;AACD;;AAEO,EAAA,gBAAgB,GAAA;AACtB,UAAM,SAAS,GAAG,YAAY,CAAC,OAAb,CAAqB,WAArB,CAAlB;AACA,QAAI,SAAJ,EAAe,KAAK,UAAL,GAAkB,IAAI,CAAC,KAAL,CAAW,SAAX,CAAlB;AAChB;;AA/D0B;;;mBAAhB,gB,EAAgB,EAAA,CAAA,QAAA,CAAA,EAAA,CAAA,UAAA,C;AAAA,C;;;SAAhB,gB;AAAgB,EAAA,OAAA,EAAhB,gBAAgB,CAAA,I;AAAA,EAAA,UAAA,EAFf","sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { costumers } from '../data/data';\r\nimport { RandomUser, RandomUsers } from '../domain-layer/entities/random-users';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class CostumersService {\r\n  private _costumers: RandomUser[];\r\n\r\n  readonly pageUsers: Map<number, RandomUser[]> = new Map<\r\n    number,\r\n    RandomUser[]\r\n  >();\r\n\r\n  constructor(private readonly httpClient: HttpClient) {\r\n    this._costumers = costumers;\r\n  }\r\n\r\n  get getCostumersLength(): number {\r\n    return this._costumers.length;\r\n  }\r\n\r\n  getCostumersByPage(itemsPerPage: number, page: number): Promise<RandomUser[]> {\r\n    const endIndex = itemsPerPage * (page + 1);\r\n    const startingIndex = endIndex - itemsPerPage;\r\n    if (endIndex < this._costumers.length) {\r\n      return this.getCostumersByPage(itemsPerPage, page);\r\n    } else {\r\n      return this.loadRandomUsers(itemsPerPage)\r\n    }\r\n  }\r\n\r\n  getCostumersFromStorage(amount: number, page: number) {\r\n    let costumersList: any[] = [];\r\n    const endIndex = amount * (page + 1);\r\n    const startingIndex = endIndex - amount;\r\n    for (\r\n      let i = startingIndex;\r\n      i < this._costumers.length && i < endIndex;\r\n      i++\r\n    ) {\r\n      costumersList.push(this._costumers[i]);\r\n    }\r\n    return costumersList;\r\n  }\r\n\r\n  async loadRandomUsers(\r\n    itemsPerPage: number\r\n  ): Promise<RandomUser[]> {\r\n    const pageNumber = 1;\r\n    const users = await this.httpClient\r\n      .get<RandomUsers>(\r\n        `https://randomuser.me/api/?page=${pageNumber}&results=${itemsPerPage}`\r\n      )\r\n      .toPromise();\r\n    console.log({ users });\r\n\r\n    this._costumers.push(... users.results);\r\n    this.saveToLocalstorage();\r\n    return users.results;\r\n  }\r\n\r\n  private saveToLocalstorage(): void {\r\n    localStorage.setItem('costumers', JSON.stringify(this._costumers));\r\n  }\r\n\r\n  private loadLocalstorage(): void {\r\n    const costumers = localStorage.getItem('costumers')\r\n    if (costumers) this._costumers = JSON.parse(costumers) as RandomUser[]\r\n  }\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}