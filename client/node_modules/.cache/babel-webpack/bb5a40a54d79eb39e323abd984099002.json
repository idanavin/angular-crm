{"ast":null,"code":"import _asyncToGenerator from \"D:/Code/angular-crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class CostumersService {\n  constructor(httpClient) {\n    this.httpClient = httpClient;\n    this._costumers = [];\n    this.pageUsers = new Map();\n  }\n\n  get getCostumersLength() {\n    return this._costumers.length;\n  }\n\n  getCostumersByPage(itemsPerPage, page) {\n    const lastIndex = itemsPerPage * (page + 1);\n    const firstIndex = lastIndex - itemsPerPage;\n\n    if (lastIndex <= this._costumers.length) {\n      return this.getLocalCostumers(firstIndex, lastIndex);\n    } else {\n      const newUsers = this.loadRandomUsers(itemsPerPage);\n      return newUsers;\n    }\n  }\n\n  getLocalCostumers(firstIndex, lastIndex) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      return _this._costumers.slice(firstIndex, lastIndex);\n    })();\n  }\n\n  loadRandomUsers(itemsPerPage) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const pageNumber = 1;\n      const users = yield _this2.httpClient.get(`https://randomuser.me/api/?page=${pageNumber}&results=${itemsPerPage}`).toPromise();\n      console.log({\n        users\n      });\n\n      _this2._costumers.push(...users.results);\n\n      _this2.saveToLocalstorage();\n\n      return users.results;\n    })();\n  }\n\n  saveToLocalstorage() {\n    localStorage.setItem('costumers', JSON.stringify(this._costumers));\n  }\n\n  loadLocalstorage() {\n    const costumers = localStorage.getItem('costumers');\n    if (costumers) this._costumers = JSON.parse(costumers);\n  }\n\n}\n\nCostumersService.ɵfac = function CostumersService_Factory(t) {\n  return new (t || CostumersService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nCostumersService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CostumersService,\n  factory: CostumersService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["D:\\Code\\angular-crm\\src\\app\\services\\costumers.service.ts"],"names":[],"mappings":";;;AAQA,OAAM,MAAO,gBAAP,CAAuB;AAQ3B,EAAA,WAAA,CAA6B,UAA7B,EAAmD;AAAtB,SAAA,UAAA,GAAA,UAAA;AAPrB,SAAA,UAAA,GAA2B,EAA3B;AAEC,SAAA,SAAA,GAAuC,IAAI,GAAJ,EAAvC;AAMR;;AAEqB,MAAlB,kBAAkB,GAAA;AACpB,WAAO,KAAK,UAAL,CAAgB,MAAvB;AACD;;AAED,EAAA,kBAAkB,CAAC,YAAD,EAAuB,IAAvB,EAAmC;AACnD,UAAM,SAAS,GAAG,YAAY,IAAI,IAAI,GAAG,CAAX,CAA9B;AACA,UAAM,UAAU,GAAG,SAAS,GAAG,YAA/B;;AAEA,QAAI,SAAS,IAAI,KAAK,UAAL,CAAgB,MAAjC,EAAyC;AACvC,aAAO,KAAK,iBAAL,CAAuB,UAAvB,EAAmC,SAAnC,CAAP;AACD,KAFD,MAEO;AACL,YAAM,QAAQ,GAAG,KAAK,eAAL,CAAqB,YAArB,CAAjB;AACA,aAAO,QAAP;AACD;AACF;;AAEa,EAAA,iBAAiB,CAAC,UAAD,EAAqB,SAArB,EAAsC;AAAA;;AAAA;AACnE,aAAO,KAAI,CAAC,UAAL,CAAgB,KAAhB,CAAsB,UAAtB,EAAkC,SAAlC,CAAP;AADmE;AAEpE;;AAEK,EAAA,eAAe,CAAC,YAAD,EAAqB;AAAA;;AAAA;AACxC,YAAM,UAAU,GAAG,CAAnB;AACA,YAAM,KAAK,SAAS,MAAI,CAAC,UAAL,CACjB,GADiB,CAEhB,mCAAmC,UAAU,YAAY,YAAY,EAFrD,EAIjB,SAJiB,EAApB;AAKA,MAAA,OAAO,CAAC,GAAR,CAAY;AAAE,QAAA;AAAF,OAAZ;;AAEA,MAAA,MAAI,CAAC,UAAL,CAAgB,IAAhB,CAAqB,GAAG,KAAK,CAAC,OAA9B;;AACA,MAAA,MAAI,CAAC,kBAAL;;AACA,aAAO,KAAK,CAAC,OAAb;AAXwC;AAYzC;;AAEO,EAAA,kBAAkB,GAAA;AACxB,IAAA,YAAY,CAAC,OAAb,CAAqB,WAArB,EAAkC,IAAI,CAAC,SAAL,CAAe,KAAK,UAApB,CAAlC;AACD;;AAED,EAAA,gBAAgB,GAAA;AACd,UAAM,SAAS,GAAG,YAAY,CAAC,OAAb,CAAqB,WAArB,CAAlB;AACA,QAAI,SAAJ,EAAe,KAAK,UAAL,GAAkB,IAAI,CAAC,KAAL,CAAW,SAAX,CAAlB;AAChB;;AApD0B;;;mBAAhB,gB,EAAgB,EAAA,CAAA,QAAA,CAAA,EAAA,CAAA,UAAA,C;AAAA,C;;;SAAhB,gB;AAAgB,EAAA,OAAA,EAAhB,gBAAgB,CAAA,I;AAAA,EAAA,UAAA,EAFf","sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { costumers } from '../data/data';\r\nimport { RandomUser, RandomUsers } from '../domain-layer/entities/random-users';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class CostumersService {\r\n  private _costumers: RandomUser[] = [];\r\n\r\n  readonly pageUsers: Map<number, RandomUser[]> = new Map<\r\n    number,\r\n    RandomUser[]\r\n  >();\r\n\r\n  constructor(private readonly httpClient: HttpClient) {\r\n  }\r\n\r\n  get getCostumersLength(): number {\r\n    return this._costumers.length;\r\n  }\r\n\r\n  getCostumersByPage(itemsPerPage: number, page: number): Promise<RandomUser[]> {\r\n    const lastIndex = itemsPerPage * (page + 1);\r\n    const firstIndex = lastIndex - itemsPerPage;\r\n\r\n    if (lastIndex <= this._costumers.length) {\r\n      return this.getLocalCostumers(firstIndex, lastIndex);\r\n    } else {\r\n      const newUsers = this.loadRandomUsers(itemsPerPage)\r\n      return newUsers\r\n    }\r\n  }\r\n\r\n  private async getLocalCostumers(firstIndex: number, lastIndex: number): Promise<RandomUser[]> {\r\n    return this._costumers.slice(firstIndex, lastIndex);\r\n  }\r\n\r\n  async loadRandomUsers(itemsPerPage: number): Promise<RandomUser[]> {\r\n    const pageNumber = 1;\r\n    const users = await this.httpClient\r\n      .get<RandomUsers>(\r\n        `https://randomuser.me/api/?page=${pageNumber}&results=${itemsPerPage}`\r\n      )\r\n      .toPromise();\r\n    console.log({ users });\r\n\r\n    this._costumers.push(...users.results);\r\n    this.saveToLocalstorage();\r\n    return users.results\r\n  }\r\n\r\n  private saveToLocalstorage(): void {\r\n    localStorage.setItem('costumers', JSON.stringify(this._costumers));\r\n  }\r\n\r\n  loadLocalstorage(): void {\r\n    const costumers = localStorage.getItem('costumers')\r\n    if (costumers) this._costumers = JSON.parse(costumers) as RandomUser[]\r\n  }\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}