{"ast":null,"code":"import _asyncToGenerator from \"D:/Code/angular-crm/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { products as localProducts } from '../data/data';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./local-save.service\";\nexport class ProductsService {\n  constructor(httpClient, localSaveService) {\n    this.httpClient = httpClient;\n    this.localSaveService = localSaveService;\n    this.categories = this.localSaveService.loadCategories();\n  }\n\n  getProductsAndCategories(amountOfProducts = 20) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const products = yield _this.getProducts(amountOfProducts);\n      return [products, _this.categories];\n    })();\n  }\n\n  getProducts(amount = 20) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.loadProducts();\n\n      if (!_this2.products) {\n        yield _this2._setProducts(amount);\n      }\n\n      return _this2.products;\n    })();\n  }\n\n  _setProducts(amount = 20) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        const products = yield _this3._getAmountOfProducts(amount);\n        _this3.products = products;\n      } catch (error) {\n        console.log(`couldn't get online products, getting from data`);\n        console.log(error);\n        _this3.products = localProducts;\n      }\n\n      _this3.setCategories(_this3.products);\n\n      _this3.localSaveService.saveToLocal('products', _this3.products);\n    })();\n  }\n\n  getPurchasableIds() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      if (!_this4.products) {\n        yield _this4._setProducts();\n      }\n\n      return (_a = _this4.products) === null || _a === void 0 ? void 0 : _a.map(product => product.id);\n    })();\n  }\n\n  getProductPrice(productId) {\n    var _a;\n\n    const product = (_a = this.products) === null || _a === void 0 ? void 0 : _a.find(product => product.id === productId);\n\n    try {\n      return product.price;\n    } catch (_b) {\n      throw product;\n    }\n  }\n\n  loadProducts() {\n    const products = this.localSaveService.loadProducts();\n\n    if (products) {\n      this.products = products;\n    }\n  }\n\n  setCategories(products) {\n    products.map(product => {\n      var _a;\n\n      const category = (_a = this.categories) === null || _a === void 0 ? void 0 : _a.find(category => category === product.category);\n\n      if (!category) {\n        this.categories.push(product.category);\n      }\n    });\n    this.localSaveService.saveToLocal('product_categories', this.categories);\n  }\n\n  _getAmountOfProducts(amount = 20) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const products = yield _this5.httpClient.get(`https://fakestoreapi.com/products?limit=${amount}`).toPromise();\n      products.forEach(product => product.purchased = 0);\n      return products;\n    })();\n  }\n\n  increasePurchaseCounter(productId) {\n    var _a;\n\n    const product = (_a = this.products) === null || _a === void 0 ? void 0 : _a.find(product => product.id === productId);\n\n    if (product) {\n      product.purchased += 1;\n    }\n  }\n\n}\n\nProductsService.ɵfac = function ProductsService_Factory(t) {\n  return new (t || ProductsService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.LocalSaveService));\n};\n\nProductsService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ProductsService,\n  factory: ProductsService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["D:\\Code\\angular-crm\\client\\src\\app\\services\\products.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { RandomProduct } from '../interface/product';\r\nimport { LocalSaveService } from './local-save.service';\r\nimport { products as localProducts} from '../data/data'\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class ProductsService {\r\n  products?: RandomProduct[];\r\n  categories: string[];\r\n\r\n  constructor(\r\n    private httpClient: HttpClient,\r\n    private localSaveService: LocalSaveService\r\n  ) {\r\n    this.categories = this.localSaveService.loadCategories();\r\n  }\r\n\r\n  async getProductsAndCategories(amountOfProducts: number = 20) {\r\n    const products = await this.getProducts(amountOfProducts);\r\n    return [products, this.categories];\r\n  }\r\n\r\n  async getProducts(amount: number = 20): Promise<RandomProduct[]> {\r\n    this.loadProducts();\r\n    if (!this.products) {\r\n      await this._setProducts(amount);\r\n    }\r\n    return this.products!;\r\n  }\r\n\r\n  private async _setProducts(amount: number = 20) {\r\n    try {\r\n      const products = await this._getAmountOfProducts(amount);\r\n      this.products = products;\r\n    } catch (error) {\r\n      console.log(`couldn't get online products, getting from data`);\r\n      console.log(error);\r\n      this.products = localProducts;\r\n    }\r\n    this.setCategories(this.products!);\r\n    this.localSaveService.saveToLocal('products', this.products!);\r\n  }\r\n\r\n  async getPurchasableIds(): Promise<number[]> {\r\n    if (!this.products) {\r\n      await this._setProducts();\r\n    }\r\n    return this.products?.map((product) => product.id)!;\r\n  }\r\n\r\n  getProductPrice(productId: number): string {\r\n    const product = this.products?.find((product) => product.id === productId);\r\n    try {\r\n      return product!.price;\r\n    } catch {\r\n      throw product;\r\n    }\r\n  }\r\n\r\n  loadProducts() {\r\n    const products = this.localSaveService.loadProducts();\r\n    if (products) {\r\n      this.products = products;\r\n    }\r\n  }\r\n\r\n  setCategories(products: RandomProduct[]) {\r\n    products.map((product) => {\r\n      const category = this.categories?.find(\r\n        (category) => category === product.category\r\n      );\r\n      if (!category) {\r\n        this.categories.push(product.category);\r\n      }\r\n    });\r\n    this.localSaveService.saveToLocal('product_categories', this.categories);\r\n  }\r\n\r\n  private async _getAmountOfProducts(\r\n    amount: number = 20\r\n  ): Promise<RandomProduct[]> {\r\n    const products = await this.httpClient\r\n      .get<RandomProduct[]>(`https://fakestoreapi.com/products?limit=${amount}`)\r\n      .toPromise();\r\n    products.forEach((product) => (product.purchased = 0));\r\n    return products;\r\n  }\r\n\r\n  increasePurchaseCounter(productId: number) {\r\n    const product = this.products?.find((product) => product.id === productId);\r\n    if (product) {\r\n      product.purchased! += 1;\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}